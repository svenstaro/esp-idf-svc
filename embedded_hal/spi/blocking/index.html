<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Blocking SPI API"><meta name="keywords" content="rust, rustlang, rust-lang, blocking"><title>embedded_hal::spi::blocking - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../../../normalize.css"><link rel="stylesheet" type="text/css" href="../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../../../dark.css" disabled><link rel="stylesheet" type="text/css" href="../../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../../storage.js"></script><script src="../../../crates.js"></script><script defer src="../../../main.js"></script>
    <noscript><link rel="stylesheet" href="../../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../../favicon.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../../embedded_hal/index.html"><div class="logo-container"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../../../embedded_hal/index.html"><div class="logo-container"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"><a href="#">Module blocking</a></h2><div class="sidebar-elems"><section><div class="block"><ul><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li></ul></div></section><div id="sidebar-vars" data-name="blocking" data-ty="mod" data-relpath="./"></div><script defer src="./sidebar-items.js"></script></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../../embedded_hal/index.html"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></a><nav class="sub"><div class="theme-picker hidden"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="22" height="22" alt="Pick another theme!" src="../../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../wheel.svg"></a></div></form></nav></div><section id="main-content" class="content"><div class="main-heading">
    <h1 class="fqn"><span class="in-band">Module <a href="../../index.html">embedded_hal</a>::<wbr><a href="../index.html">spi</a>::<wbr><a class="mod" href="#">blocking</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../../../src/embedded_hal/spi/blocking.rs.html#1-422">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Blocking SPI API</p>
<h2 id="bus-vs-device"><a href="#bus-vs-device">Bus vs Device</a></h2>
<p>SPI allows sharing a single bus between many SPI devices. The SCK, MOSI and MISO lines are
wired in parallel to all the devices, and each device gets a dedicated chip-select (CS) line from the MCU, like this:</p>
<?xml version="1.0" encoding="UTF-8"?>
<!-- Do not edit this file with editors other than diagrams.net -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<p><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="382px" height="322px" viewBox="-0.5 -0.5 382 322" content="&lt;mxfile host=&quot;app.diagrams.net&quot; modified=&quot;2022-02-15T23:37:14.963Z&quot; agent=&quot;5.0 (X11)&quot; etag=&quot;_1iMPbCJGwQuwz6QJ5_u&quot; version=&quot;16.5.6&quot;&gt;&lt;diagram id=&quot;GDSX7qAwtoJQx5dvUb6s&quot; name=&quot;Page-1&quot;&gt;7Vtdl6I2GP41XupJCCBcrjrTndPuWbu23e3VHkYyyhHBQhy1v74BEiUhKqN8OHX0QvKSz/d58uYJxA4aLre/RM5q/iV0sd/RgLvtoFFH0yDSTfqTWHbMYgOQWWaR5zLbwTDx/sXMyLOtPRfHQkYShj7xVqJxGgYBnhLB5kRRuBGzvYS+2OrKmeGCYTJ1/KL1u+eSeWa1DHCwf8bebM5bhnx8z850MYvCdcDaC8IAZ3eWDq+GZY3njhtucib00EHDKAxJdrXcDrGf+JV7LCv3eOTuvssRDkiZApvFYvxttxqR4I/fH5efzVFsbLoGQ+7V8dfMF6y3ZMedkw4PJ7WADhps5h7Bk5UzTe5uKB+obU6WPk1Bevni+f4w9MMoLYt0I/lSe0yicIH5ndRNaMDaxhHB26OjgntfUf7hcIlJtKNZWAHuXca8LmfU5gAjsphtnoMQ8YIOo85sX/XBh/SCuVHt0qHud8fm6KeGV4vfnp+/x9+8Wdew6nUpSD977xVcpXDoUe/povcUzoOawnnQqM15SOE806ftDlzvNWnR92ZBesP8Z51MnUGU9mufpFez5Hcy/JWXpD1JC2c3CmBQXxHR40qy5mFgJt6ZrAtokDjeo1HlE7MvPddNWlEiLHKgAjD7IphGEUzVRKhiHihDC6wKyS9Pk6/vD8qropoEZb9lKM9MSgbT18nTfcNktwyTXgam4eQnvG+YoGKZaxQnoyRO2p3jhFrGSaWNi2Fv+GdjME2pI3F0HU4vYUAmrFPHJMZbQDNE0DSFhARNgtZXgFaf+r5u72JeKL9RXc5TbV0KjG9SWfv4pf24dGvK2i4Vl5pUzTcJU9uqmU/nG5LNN4lT27IZntmpcj123yi1rpphcRc6GdOpA0YPfz0NH+gFvBPJJUPTuuaCqp3nexFdZuuqC5baEN697NJA2xGo3Ibw7oWXKiA1C5RqE/ihvIpA6W0DVWrDee/SS1MsUc3CVGrHKakxrTHQ3oNGg4rdaLMijVd8SqThwP2UHKdInOo7cexNRWREn+GtR34k1z3btlj67zSNEGLp0TaXebTLJcY48ujIEuAyW0BH+SOfYHVZOjccKktTu3xKri4bG3YLBz8Kb1jjcB1NWa6Tb/SJE80wOeHivpoSOcgNBeLcFmHfId6r2F8VDVgL49CjI9kzDtoi4/oSkbJhskIHLhXqkQ8FyITMvFCoJ+XkftBX0LTE8YnLaAp7ANgCTQ3broympg0/aFqCpvL+y7J7AF3GVNiXqyrFVEodZ5fLtkoyxCd6DKVQDoSDVvQiq7HaaaBacq+bBpy4XdADEIrstXS7XvbeNimhCUWI5aBXOnhKr8MgtHuWZh8+VqPBFJU43ncFi4AuscioOQaeZVH2JOpmaIRsui5UxCRalwHfzKS3BjtoSc3q4GQ35fxaH9YfHI3qpezRVf0SQscUDMJbD2kvue3R83n7/xvS7x/LScvjBcLTFqmk272+Wc+SLvWZ+6Je1qreMx1nLePNWVmbLueSrtUu0bXuRezMy9JbZKd0QNy6lJxn6qmKmFIzGtOB9RJTqzyc7p8MACA+GTCQ9WZqVkjGdrc+ulUJF6G8hWp2h648o1/L6oss42P5PUsqkQzmpaQ6ciqj6gAnP12CV628NHn4B1WW/fAXNfTwHw==&lt;/diagram&gt;&lt;/mxfile&gt;"><defs/><g><rect x="0" y="0" width="380" height="320" fill="#454545" stroke="none" pointer-events="all"/><rect x="20" y="20" width="120" height="150" fill="#000000" stroke="rgb(240, 240, 240)" pointer-events="all"/><rect x="50" y="60" width="80" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-end; width: 78px; height: 1px; padding-top: 70px; margin-left: 50px;"><div style="box-sizing: border-box; font-size: 0px; text-align: right;" data-drawio-colors="color: rgb(240, 240, 240); "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div align="right">SCK</div></div></div></div></foreignObject><text x="128" y="74" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px" text-anchor="end">SCK</text></switch></g><rect x="50" y="80" width="80" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-end; width: 78px; height: 1px; padding-top: 90px; margin-left: 50px;"><div style="box-sizing: border-box; font-size: 0px; text-align: right;" data-drawio-colors="color: rgb(240, 240, 240); "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div align="right">MISO</div></div></div></div></foreignObject><text x="128" y="94" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px" text-anchor="end">MISO</text></switch></g><rect x="50" y="100" width="80" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-end; width: 78px; height: 1px; padding-top: 110px; margin-left: 50px;"><div style="box-sizing: border-box; font-size: 0px; text-align: right;" data-drawio-colors="color: rgb(240, 240, 240); "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>MOSI</div></div></div></div></foreignObject><text x="128" y="114" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px" text-anchor="end">MOSI</text></switch></g><rect x="50" y="120" width="80" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-end; width: 78px; height: 1px; padding-top: 130px; margin-left: 50px;"><div style="box-sizing: border-box; font-size: 0px; text-align: right;" data-drawio-colors="color: rgb(240, 240, 240); "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>CS_1</div></div></div></div></foreignObject><text x="128" y="134" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px" text-anchor="end">CS_1</text></switch></g><rect x="50" y="140" width="80" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-end; width: 78px; height: 1px; padding-top: 150px; margin-left: 50px;"><div style="box-sizing: border-box; font-size: 0px; text-align: right;" data-drawio-colors="color: rgb(240, 240, 240); "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>CS_2</div></div></div></div></foreignObject><text x="128" y="154" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px" text-anchor="end">CS_2</text></switch></g><rect x="30" y="30" width="100" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 98px; height: 1px; padding-top: 40px; margin-left: 31px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(240, 240, 240); "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;"><div>MCU</div></div></div></div></foreignObject><text x="80" y="44" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">MCU</text></switch></g><rect x="240" y="20" width="120" height="130" fill="#000000" stroke="rgb(240, 240, 240)" pointer-events="all"/><rect x="250" y="60" width="80" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 78px; height: 1px; padding-top: 70px; margin-left: 252px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;" data-drawio-colors="color: rgb(240, 240, 240); "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>SCK</div></div></div></div></foreignObject><text x="252" y="74" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px">SCK</text></switch></g><rect x="250" y="80" width="80" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 78px; height: 1px; padding-top: 90px; margin-left: 252px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;" data-drawio-colors="color: rgb(240, 240, 240); "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>MISO</div></div></div></div></foreignObject><text x="252" y="94" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px">MISO</text></switch></g><rect x="250" y="100" width="80" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 78px; height: 1px; padding-top: 110px; margin-left: 252px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;" data-drawio-colors="color: rgb(240, 240, 240); "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>MOSI</div></div></div></div></foreignObject><text x="252" y="114" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px">MOSI</text></switch></g><rect x="250" y="120" width="80" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 78px; height: 1px; padding-top: 130px; margin-left: 252px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;" data-drawio-colors="color: rgb(240, 240, 240); "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>CS</div></div></div></div></foreignObject><text x="252" y="134" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px">CS</text></switch></g><rect x="250" y="30" width="100" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 98px; height: 1px; padding-top: 40px; margin-left: 251px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(240, 240, 240); "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;">SPI DEVICE 1</div></div></div></foreignObject><text x="300" y="44" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">SPI DEVICE 1</text></switch></g><rect x="240" y="170" width="120" height="130" fill="#000000" stroke="rgb(240, 240, 240)" pointer-events="all"/><rect x="250" y="210" width="80" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 78px; height: 1px; padding-top: 220px; margin-left: 252px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;" data-drawio-colors="color: rgb(240, 240, 240); "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>SCK</div></div></div></div></foreignObject><text x="252" y="224" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px">SCK</text></switch></g><rect x="250" y="230" width="80" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 78px; height: 1px; padding-top: 240px; margin-left: 252px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;" data-drawio-colors="color: rgb(240, 240, 240); "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>MISO</div></div></div></div></foreignObject><text x="252" y="244" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px">MISO</text></switch></g><rect x="250" y="250" width="80" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 78px; height: 1px; padding-top: 260px; margin-left: 252px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;" data-drawio-colors="color: rgb(240, 240, 240); "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>MOSI</div></div></div></div></foreignObject><text x="252" y="264" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px">MOSI</text></switch></g><rect x="250" y="270" width="80" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 78px; height: 1px; padding-top: 280px; margin-left: 252px;"><div style="box-sizing: border-box; font-size: 0px; text-align: left;" data-drawio-colors="color: rgb(240, 240, 240); "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>CS</div></div></div></div></foreignObject><text x="252" y="284" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px">CS</text></switch></g><rect x="250" y="180" width="100" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 98px; height: 1px; padding-top: 190px; margin-left: 251px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(240, 240, 240); "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; overflow-wrap: normal;"><div>SPI DEVICE 2</div></div></div></div></foreignObject><text x="300" y="194" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">SPI DEVICE 2</text></switch></g><path d="M 139.76 69.95 L 233.63 69.92" fill="none" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 238.88 69.92 L 231.88 73.42 L 233.63 69.92 L 231.88 66.42 Z" fill="rgb(240, 240, 240)" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="all"/><path d="M 141.08 109.85 L 190 110 L 233.63 109.85" fill="none" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 238.88 109.83 L 231.89 113.36 L 233.63 109.85 L 231.87 106.36 Z" fill="rgb(240, 240, 240)" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="all"/><path d="M 141 130 L 232.31 130.35" fill="none" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 237.56 130.37 L 230.55 133.84 L 232.31 130.35 L 230.58 126.84 Z" fill="rgb(240, 240, 240)" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="all"/><path d="M 141 149.69 L 160 150 L 160 281 L 233.15 280.66" fill="none" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 238.4 280.64 L 231.42 284.17 L 233.15 280.66 L 231.39 277.17 Z" fill="rgb(240, 240, 240)" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="all"/><path d="M 180 113 L 180 260 L 233.63 259.73" fill="none" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="180" cy="110" rx="3" ry="3" fill="rgb(240, 240, 240)" stroke="rgb(240, 240, 240)" pointer-events="all"/><path d="M 238.88 259.71 L 231.9 263.24 L 233.63 259.73 L 231.86 256.24 Z" fill="rgb(240, 240, 240)" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="all"/><path d="M 237.72 238.77 L 200 239 L 200 93" fill="none" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="200" cy="90" rx="3" ry="3" fill="rgb(240, 240, 240)" stroke="rgb(240, 240, 240)" pointer-events="all"/><path d="M 240.96 89.94 L 146.37 90" fill="none" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 141.12 90 L 148.12 86.5 L 146.37 90 L 148.12 93.5 Z" fill="rgb(240, 240, 240)" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="all"/><path d="M 220 73 L 220 220 L 233.63 220.03" fill="none" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="220" cy="70" rx="3" ry="3" fill="rgb(240, 240, 240)" stroke="rgb(240, 240, 240)" pointer-events="all"/><path d="M 238.88 220.05 L 231.87 223.53 L 233.63 220.03 L 231.89 216.53 Z" fill="rgb(240, 240, 240)" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="all"/></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg></p>
<p>CS is usually active-low. When CS is high (not asserted), SPI devices ignore all incoming data, and
don’t drive MISO. When CS is low (asserted), the device is active: reacts to incoming data on MOSI and
drives MISO with the response data. By asserting one CS or another, the MCU can choose to which
SPI device it “talks” to on the (possibly shared) bus.</p>
<p>This bus sharing is common when having multiple SPI devices in the same board, since it uses fewer MCU
pins (<code>n+3</code> instead of <code>4*n</code>), and fewer MCU SPI peripherals (<code>1</code> instead of <code>n</code>).</p>
<p>However, it poses a challenge when building portable drivers for SPI devices. The driver needs to
be able to talk to its device on the bus, while not interfering with other drivers talking to other
devices.</p>
<p>To solve this, <code>embedded-hal</code> has two kinds of SPI traits: <strong>SPI bus</strong> and <strong>SPI device</strong>.</p>
<h3 id="bus"><a href="#bus">Bus</a></h3>
<p>SPI bus traits represent <strong>exclusive ownership</strong> over the whole SPI bus. This is usually the entire
SPI MCU peripheral, plus the SCK, MOSI and MISO pins.</p>
<p>Owning an instance of an SPI bus guarantees exclusive access, this is, we have the guarantee no other
piece of code will try to use the bus while we own it.</p>
<p>There’s 3 bus traits, depending on the bus capabilities.</p>
<ul>
<li><a href="trait.SpiBus.html" title="SpiBus"><code>SpiBus</code></a>: Read-write access. This is the most commonly used.</li>
<li><a href="trait.SpiBusRead.html" title="SpiBusRead"><code>SpiBusRead</code></a>: Read-only access, for example a bus with a MISO pin but no MOSI pin.</li>
<li><a href="trait.SpiBusWrite.html" title="SpiBusWrite"><code>SpiBusWrite</code></a>: Read-write access, for example a bus with a MOSI pin but no MISO pin.</li>
</ul>
<h3 id="device"><a href="#device">Device</a></h3>
<p><a href="trait.SpiDevice.html" title="SpiDevice"><code>SpiDevice</code></a> represents <strong>ownership over a single SPI device selected by a CS pin</strong> in a (possibly shared) bus. This is typically:</p>
<ul>
<li>Exclusive ownership of the <strong>CS pin</strong>.</li>
<li>Access to the <strong>underlying SPI bus</strong>. If shared, it’ll be behind some kind of lock/mutex.</li>
</ul>
<p>An <a href="trait.SpiDevice.html" title="SpiDevice"><code>SpiDevice</code></a> allows initiating <a href="trait.SpiDevice.html#tymethod.transaction">transactions</a> against the target device on the bus. A transaction
consists of asserting CS, then doing one or more transfers, then deasserting CS. For the entire duration of the transaction, the <a href="trait.SpiDevice.html" title="SpiDevice"><code>SpiDevice</code></a>
implementation will ensure no other transaction can be opened on the same bus. This is the key that allows correct sharing of the bus.</p>
<p>The capabilities of the bus (read-write, read-only or write-only) are determined by which of the <a href="trait.SpiBus.html" title="SpiBus"><code>SpiBus</code></a>, <a href="trait.SpiBusRead.html" title="SpiBusRead"><code>SpiBusRead</code></a> <a href="trait.SpiBusWrite.html" title="SpiBusWrite"><code>SpiBusWrite</code></a> traits
are implemented for the <a href="trait.SpiDevice.html#associatedtype.Bus"><code>Bus</code></a> associated type.</p>
<h2 id="for-driver-authors"><a href="#for-driver-authors">For driver authors</a></h2>
<p>When implementing a driver, it’s crucial to pick the right trait, to ensure correct operation
with maximum interoperability. Here are some guidelines depending on the device you’re implementing a driver for:</p>
<p>If your device <strong>has a CS pin</strong>, use <a href="trait.SpiDevice.html" title="SpiDevice"><code>SpiDevice</code></a>. Do not manually manage the CS pin, the <a href="trait.SpiDevice.html" title="SpiDevice"><code>SpiDevice</code></a> implementation will do it for you.
Add bounds like <code>where T::Bus: SpiBus</code>, <code>where T::Bus: SpiBusRead</code>, <code>where T::Bus: SpiBusWrite</code> to specify the kind of access you need.
By using <a href="trait.SpiDevice.html" title="SpiDevice"><code>SpiDevice</code></a>, your driver will cooperate nicely with other drivers for other devices in the same shared SPI bus.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">MyDriver</span><span class="op">&lt;</span><span class="ident">SPI</span><span class="op">&gt;</span> {
    <span class="ident">spi</span>: <span class="ident">SPI</span>,
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">SPI</span><span class="op">&gt;</span> <span class="ident">MyDriver</span><span class="op">&lt;</span><span class="ident">SPI</span><span class="op">&gt;</span>
<span class="kw">where</span>
    <span class="ident">SPI</span>: <span class="ident">SpiDevice</span>,
    <span class="ident">SPI::Bus</span>: <span class="ident">SpiBus</span>, <span class="comment">// or SpiBusRead/SpiBusWrite if you only need to read or only write.</span>
{
    <span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">new</span>(<span class="ident">spi</span>: <span class="ident">SPI</span>) -&gt; <span class="self">Self</span> {
        <span class="self">Self</span> { <span class="ident">spi</span> }
    }

    <span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">read_foo</span>(<span class="kw-2">&amp;mut</span> <span class="self">self</span>) -&gt; <span class="prelude-ty">Result</span><span class="op">&lt;</span>[<span class="ident">u8</span>; <span class="number">2</span>], <span class="ident">MyError</span><span class="op">&lt;</span><span class="ident">SPI::Error</span><span class="op">&gt;</span><span class="op">&gt;</span> {
        <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">buf</span> <span class="op">=</span> [<span class="number">0</span>; <span class="number">2</span>];

        <span class="comment">// `transaction` asserts and deasserts CS for us. No need to do it manually!</span>
        <span class="self">self</span>.<span class="ident">spi</span>.<span class="ident">transaction</span>(<span class="op">|</span><span class="ident">bus</span><span class="op">|</span> {
            <span class="ident">bus</span>.<span class="ident">write</span>(<span class="kw-2">&amp;</span>[<span class="number">0x90</span>])<span class="question-mark">?</span>;
            <span class="ident">bus</span>.<span class="ident">read</span>(<span class="kw-2">&amp;mut</span> <span class="ident">buf</span>)
        }).<span class="ident">map_err</span>(<span class="ident">MyError::Spi</span>)<span class="question-mark">?</span>;

        <span class="prelude-val">Ok</span>(<span class="ident">buf</span>)
    }
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Copy</span>, <span class="ident">Clone</span>, <span class="ident">Debug</span>)]</span>
<span class="kw">enum</span> <span class="ident">MyError</span><span class="op">&lt;</span><span class="ident">SPI</span><span class="op">&gt;</span> {
    <span class="ident">Spi</span>(<span class="ident">SPI</span>),
    <span class="comment">// Add other errors for your driver here.</span>
}</code></pre></div>
<p>If your device <strong>does not have a CS pin</strong>, use <a href="trait.SpiBus.html" title="SpiBus"><code>SpiBus</code></a> (or <a href="trait.SpiBusRead.html" title="SpiBusRead"><code>SpiBusRead</code></a>, <a href="trait.SpiBusWrite.html" title="SpiBusWrite"><code>SpiBusWrite</code></a>). This will ensure
your driver has exclusive access to the bus, so no other drivers can interfere. It’s not possible to safely share
a bus without CS pins. By requiring <a href="trait.SpiBus.html" title="SpiBus"><code>SpiBus</code></a> you disallow sharing, ensuring correct operation.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">MyDriver</span><span class="op">&lt;</span><span class="ident">SPI</span><span class="op">&gt;</span> {
    <span class="ident">spi</span>: <span class="ident">SPI</span>,
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">SPI</span><span class="op">&gt;</span> <span class="ident">MyDriver</span><span class="op">&lt;</span><span class="ident">SPI</span><span class="op">&gt;</span>
<span class="kw">where</span>
    <span class="ident">SPI</span>: <span class="ident">SpiBus</span>, <span class="comment">// or SpiBusRead/SpiBusWrite if you only need to read or only write.</span>
{
    <span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">new</span>(<span class="ident">spi</span>: <span class="ident">SPI</span>) -&gt; <span class="self">Self</span> {
        <span class="self">Self</span> { <span class="ident">spi</span> }
    }

    <span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">read_foo</span>(<span class="kw-2">&amp;mut</span> <span class="self">self</span>) -&gt; <span class="prelude-ty">Result</span><span class="op">&lt;</span>[<span class="ident">u8</span>; <span class="number">2</span>], <span class="ident">MyError</span><span class="op">&lt;</span><span class="ident">SPI::Error</span><span class="op">&gt;</span><span class="op">&gt;</span> {
        <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">buf</span> <span class="op">=</span> [<span class="number">0</span>; <span class="number">2</span>];
        <span class="self">self</span>.<span class="ident">spi</span>.<span class="ident">write</span>(<span class="kw-2">&amp;</span>[<span class="number">0x90</span>]).<span class="ident">map_err</span>(<span class="ident">MyError::Spi</span>)<span class="question-mark">?</span>;
        <span class="self">self</span>.<span class="ident">spi</span>.<span class="ident">read</span>(<span class="kw-2">&amp;mut</span> <span class="ident">buf</span>).<span class="ident">map_err</span>(<span class="ident">MyError::Spi</span>)<span class="question-mark">?</span>;
        <span class="prelude-val">Ok</span>(<span class="ident">buf</span>)
    }
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Copy</span>, <span class="ident">Clone</span>, <span class="ident">Debug</span>)]</span>
<span class="kw">enum</span> <span class="ident">MyError</span><span class="op">&lt;</span><span class="ident">SPI</span><span class="op">&gt;</span> {
    <span class="ident">Spi</span>(<span class="ident">SPI</span>),
    <span class="comment">// Add other errors for your driver here.</span>
}</code></pre></div>
<p>If you’re (ab)using SPI to <strong>implement other protocols</strong> by bitbanging (WS2812B, onewire, generating arbitrary waveforms…), use <a href="trait.SpiBus.html" title="SpiBus"><code>SpiBus</code></a>.
SPI bus sharing doesn’t make sense at all in this case. By requiring <a href="trait.SpiBus.html" title="SpiBus"><code>SpiBus</code></a> you disallow sharing, ensuring correct operation.</p>
<h2 id="for-hal-authors"><a href="#for-hal-authors">For HAL authors</a></h2>
<p>HALs <strong>must</strong> implement <a href="trait.SpiBus.html" title="SpiBus"><code>SpiBus</code></a>, <a href="trait.SpiBusRead.html" title="SpiBusRead"><code>SpiBusRead</code></a> and <a href="trait.SpiBusWrite.html" title="SpiBusWrite"><code>SpiBusWrite</code></a>. Users can combine the bus together with the CS pin (which should
implement <a href="../../digital/blocking/trait.OutputPin.html" title="OutputPin"><code>OutputPin</code></a>) using HAL-independent <a href="trait.SpiDevice.html" title="SpiDevice"><code>SpiDevice</code></a> implementations such as <a href="struct.ExclusiveDevice.html" title="ExclusiveDevice"><code>ExclusiveDevice</code></a>.</p>
<p>HALs may additionally implement <a href="trait.SpiDevice.html" title="SpiDevice"><code>SpiDevice</code></a> to <strong>take advantage of hardware CS management</strong>, which may provide some performance
benefits. (There’s no point in a HAL implementing <a href="trait.SpiDevice.html" title="SpiDevice"><code>SpiDevice</code></a> if the CS management is software-only, this task is better left to
the HAL-independent implementations).</p>
<p>HALs <strong>must not</strong> add infrastructure for sharing at the <a href="trait.SpiBus.html" title="SpiBus"><code>SpiBus</code></a> level. User code owning a <a href="trait.SpiBus.html" title="SpiBus"><code>SpiBus</code></a> must have the guarantee
of exclusive access.</p>
<h2 id="flushing"><a href="#flushing">Flushing</a></h2>
<p>To improve performance, <a href="trait.SpiBus.html" title="SpiBus"><code>SpiBus</code></a> implementations are allowed to return before the operation is finished, i.e. when the bus is still not
idle.</p>
<p>When using a <a href="trait.SpiBus.html" title="SpiBus"><code>SpiBus</code></a>, call <a href="trait.SpiBusFlush.html#tymethod.flush"><code>flush</code></a> to wait for operations to actually finish. Examples of situations
where this is needed are:</p>
<ul>
<li>To synchronize SPI activity and GPIO activity, for example before deasserting a CS pin.</li>
<li>Before deinitializing the hardware SPI peripheral.</li>
</ul>
<p>When using a <a href="trait.SpiDevice.html" title="SpiDevice"><code>SpiDevice</code></a>, you can still call <a href="trait.SpiBusFlush.html#tymethod.flush"><code>flush</code></a> on the bus within a transaction.
It’s very rarely needed, because <a href="trait.SpiDevice.html#tymethod.transaction"><code>transaction</code></a> already flushes for you
before deasserting CS. For example, you may need it to synchronize with GPIOs other than CS, such as DCX pins
sometimes found in SPI displays.</p>
<p>For example, for <a href="trait.SpiBusWrite.html#tymethod.write"><code>write</code></a> operations, it is common for hardware SPI peripherals to have a small
FIFO buffer, usually 1-4 bytes. Software writes data to the FIFO, and the peripheral sends it on MOSI at its own pace,
at the specified SPI frequency. It is allowed for an implementation of <a href="trait.SpiBusWrite.html#tymethod.write"><code>write</code></a> to return as soon
as all the data has been written to the FIFO, before it is actually sent. Calling <a href="trait.SpiBusFlush.html#tymethod.flush"><code>flush</code></a> would
wait until all the bits have actually been sent, the FIFO is empty, and the bus is idle.</p>
<p>This still applies to other operations such as <a href="trait.SpiBusRead.html#tymethod.read"><code>read</code></a> or <a href="trait.SpiBus.html#tymethod.transfer"><code>transfer</code></a>. It is less obvious
why, because these methods can’t return before receiving all the read data. However it’s still technically possible
for them to return before the bus is idle. For example, assuming SPI mode 0, the last bit is sampled on the first (rising) edge
of SCK, at which point a method could return, but the second (falling) SCK edge still has to happen before the bus is idle.</p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.ExclusiveDevice.html" title="embedded_hal::spi::blocking::ExclusiveDevice struct">ExclusiveDevice</a></div><div class="item-right docblock-short"><p><a href="trait.SpiDevice.html" title="SpiDevice"><code>SpiDevice</code></a> implementation with exclusive access to the bus (not shared).</p>
</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.ExclusiveDeviceError.html" title="embedded_hal::spi::blocking::ExclusiveDeviceError enum">ExclusiveDeviceError</a></div><div class="item-right docblock-short"><p>Error type for <a href="struct.ExclusiveDevice.html" title="ExclusiveDevice"><code>ExclusiveDevice</code></a> operations.</p>
</div></div></div><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.SpiBus.html" title="embedded_hal::spi::blocking::SpiBus trait">SpiBus</a></div><div class="item-right docblock-short"><p>Read-write SPI bus</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.SpiBusFlush.html" title="embedded_hal::spi::blocking::SpiBusFlush trait">SpiBusFlush</a></div><div class="item-right docblock-short"><p>Flush support for SPI bus</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.SpiBusRead.html" title="embedded_hal::spi::blocking::SpiBusRead trait">SpiBusRead</a></div><div class="item-right docblock-short"><p>Read-only SPI bus</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.SpiBusWrite.html" title="embedded_hal::spi::blocking::SpiBusWrite trait">SpiBusWrite</a></div><div class="item-right docblock-short"><p>Write-only SPI bus</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.SpiDevice.html" title="embedded_hal::spi::blocking::SpiDevice trait">SpiDevice</a></div><div class="item-right docblock-short"><p>SPI device trait</p>
</div></div></div></section><section id="search" class="content hidden"></section></div></main><div id="rustdoc-vars" data-root-path="../../../" data-current-crate="embedded_hal" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.62.0-nightly (8f36334ca 2022-04-06)" ></div>
</body></html>